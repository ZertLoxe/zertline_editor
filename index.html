<!DOCTYPE html>
<html>
<head>
    <title>Dropbox Access Token Generator</title>
</head>
<body>
    <h1>Dropbox Access Token Generator</h1>
    <p>Click the link below to generate a Dropbox access token:</p>
    <button id="generateTokenLink">Generate Token</button>

    <script>
        // Replace with your Dropbox app's client ID and redirect URI
        const clientId = 'hs2pnr348r68qex';
        const redirectUri = 'https://zertloxe.github.io/zertline_editor/index.html';
        let newWindow;

        document.getElementById('generateTokenLink').addEventListener('click', () => {
            const authUrl = `https://www.dropbox.com/oauth2/authorize?client_id=${clientId}&response_type=token&redirect_uri=${redirectUri}`;
            newWindow = window.open(authUrl, '_blank');
            if (!newWindow) {
                alert('Please allow pop-ups to proceed.');
            }
        });

        let callCount = 0;

        // Set the maximum number of times you want to call captureURL
        const maxCallCount = 10; // Change this to the desired number of times

        // Function to capture the URL of the new window
        function captureURL() {
            if (newWindow) {
                const newWindowURL = newWindow.location.href;
                console.log('URL of the new window:', newWindowURL);

                // Increment the call count
                callCount++;

                // If we've reached the desired number of calls, clear the interval
                if (callCount >= maxCallCount) {
                    clearInterval(intervalId);
                    const url = new URL(newWindowURL);
                    console.log(url);
                    const hash = url.hash;
                    const accessTokenwrong = hash.split('=')[1];
                    const accessToken = accessTokenwrong.replace("&token_type", '');
                    console.log(accessTokenwrong);
                    console.log(accessToken);
                }
            }
        }

        // Start the interval and store the interval ID
        const intervalId = setInterval(captureURL, 1000); // Check every second
    </script>
</body>
</html>

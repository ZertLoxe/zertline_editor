<!DOCTYPE html>
<html>
<head>
    <title>Dropbox Access Token Generator</title>
</head>
<body>
    <h1>Dropbox Access Token Generator</h1>
    <p>Click the button to generate a Dropbox access token:</p>
    <button id="generateToken">Generate Token</button>
    <button id="extractToken">Extract Token</button>
    <p id="accessToken"></p>

    <script>
        // Replace with your Dropbox app's client ID and redirect URI
        const clientId = 'hs2pnr348r68qex';
        const redirectUri = 'https://zertloxe.github.io/zertline_editor/index.html';

        document.getElementById('extractToken').addEventListener('click', () => {
            const url = new URL(window.location.href);
            console.log(url);
            const hash = url.hash;
            const accessTokenwrong = hash.split('=')[1];
            const accessToken = accessTokenwrong.replace("&token_type", '');
            console.log(accessTokenwrong);
            console.log(accessToken);

            updateGitHubJson()

            async function updateGitHubJson() {
            const token = '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'; // Replace with your GitHub access token
            const owner = 'ZertLoxe'; // Replace with your GitHub username
            const repo = 'zertline_editor'; // Replace with your GitHub repository name
            const path = 'index.json'; // Replace with the path to your JSON file in the repository

            const octokit = new Octokit({ auth: token });

            try {
                // Fetch the current content of the JSON file
                const { data: { content, sha } } = await octokit.repos.getContents({ owner, repo, path });
                const decodedContent = atob(content);

                // Modify the JSON data
                const jsonData = JSON.parse(decodedContent);
                jsonData.token = accessToken;

                // Update the JSON file with the modified data
                const updatedContent = JSON.stringify(jsonData, null, 4);
                const updatedContentBase64 = btoa(updatedContent);

                await octokit.repos.createOrUpdateFile({
                    owner,
                    repo,
                    path,
                    message: 'Update JSON file',
                    content: updatedContentBase64,
                    sha,
                });

                alert('JSON file updated on GitHub.');

            } catch (error) {
                console.error('An error occurred:', error);
                alert('Failed to update JSON file on GitHub.');
            }
        }
        });
        
        document.getElementById('generateToken').addEventListener('click', () => {
            const authUrl = `https://www.dropbox.com/oauth2/authorize?client_id=${clientId}&response_type=token&redirect_uri=${redirectUri}`;
            window.location.href = authUrl;
        });
    </script>
</body>
</html>